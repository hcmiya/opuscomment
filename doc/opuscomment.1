.\" This manpage has been automatically generated by docbook2man 
.\" from a DocBook document.  This tool can be found at:
.\" <http://shell.ipoline.com/~elmert/comp/docbook2X/> 
.\" Please send any bug reports, improvements, comments, patches, 
.\" etc. to Steve Cheng <steve@ggi-project.org>.
.TH "OPUSCOMMENT" "1" "2019-03-08" "1.4.8" "opuscomment 1.4 Manual"

.SH NAME
opuscomment \- Ogg Edit Opus file output gain and tag

.SH SYNOPSIS

\fBopuscomment\fR [ \fB-l\fR ] [ \fB-C \fIcodec\fB\fR ] [ \fB-i \fIidx\fB\fR ] [ \fB-DepQRUv\fR ] \fB\fIsrcfile\fB\fR

\fBopuscomment\fR { \fB-a\fR | \fB-w\fR } [ \fB-C \fIcodec\fB\fR ] [ \fB-i \fIidx\fB\fR ] [ \fB-g \fIgain\fB\fR | \fB-s \fIscale\fB\fR ] [ \fB-c \fItagfile\fB\fR ] [ \fB-t \fINAME=VALUE\fB\fR\fI ...\fR ] [ \fB-d \fINAME[=VALUE]\fB\fR\fI ...\fR ] [ \fB-1DeQprRUv\fR ] \fB\fIsrcfile\fB\fR [ \fB\fIoutput\fB\fR ]

.SH DESCRIPTION
.PP
The first format is the tag output mode, and outputs the Opus file Vorbis comment format tag to the standard output.
.PP
The second format is the tag overwrite / addition mode, and writes the tag of Vorbis comment format read from the standard input to the Opus file. If there is only one file after the option, the original file is replaced by the editing result. In the case of two cases, the editing result is outputted to another file, and the original file remains as it is. If there is an option for tag file specification, read tag from that file without using standard input. If there is an option to specify the tag directly, treat it as input. If there is an option of gain editing, it is done simultaneously with tag editing.
.PP
In any of the formats, if the option of the gain output is specified, the output gain of the Opus file is outputted to the standard error output.

.SH OPTIONS
.TP
\fB-l\fR
Tag output mode
.TP
\fB-a\fR
Tag addition mode
.TP
\fB-w\fR
Tag writing mode
.TP
\fB-h\fR
Display usage and exit
.TP
\fB-C \fIcodec\fB\fR
Specify the codec to be edited
.TP
\fB-i \fIidx\fB\fR
Specifies the stream to be edited in the multiplexed Ogg stream in the order of one starting point except for the target codec. It is assumed that the moving image file has a plurality of audio streams by dubbing or sub audio
.TP
\fB-R\fR
Use UTF-8 for tag input / output. If this option is not present, translation with character encoding by locale is performed (compatible with \fBvorbiscomment\fR(1))
.TP
\fB-e\fR
Use \\\\, \\n, \\r, \\0 escape for backslash, newline, carriage return, and null respectively (compatible with \fBvorbiscomment\fR(1))
.TP
\fB-t \fINAME=VALUE\fB\fR
Add an argument as a tag
.TP
\fB-c \fItagfile\fB\fR
In output mode, write tag to \fItagfile\fR. Read / tag from \fItagfile\fR in write / append mode
.TP
\fB-d \fINAME[=VALUE]\fB\fR
Delete the tag in the Opus file matching the argument. If \fI=VALUE\fR is omitted, all tags matching \fINAME\fR are deleted. \fB-U\fR is implicitly specified
.TP
\fB-p\fR
\fIMETADATA_BLOCK_PICTURE\fR is not output in output mode. In write mode, \fIMETADATA_BLOCK_PICTURE\fR is not deleted and the tag before editing is maintained.

If editing including \fIMETADATA_BLOCK_PICTURE\fR is done with an editor, the screen will be filled with long data that is not human readable. Also, if the data changes during the editing process, restoration becomes difficult. It is convenient to use \fB-p\fR on both the front and the back of editing to avoid such a situation. Please note that the same image will be written many times if you use \fB-p\fR only after the editing.
.TP
\fB-U\fR
If the item name of the tag in the Opus file contains lowercase letters, it is converted to capital letters. It is an option prepared for files edited by other software, \fBopuscomment\fR always converts the item name of the edit input tag to uppercase
.TP
\fB-V\fR
In the output mode, verify the validity of the format for the tag in the Opus file

Although the vorbis comment has a fixed format, Opus's internal structure can store arbitrary binary strings. In the absence of this option, if the record saved inside is valid as UTF - 8, it tries to output it as it is, even if it does not satisfy the form of vorbis comment. However, this behavior is highly likely to interfere with \fBopuscomment\fR and cooperation with other filters. Therefore it is convenient to use \fB-V\fR when editing against untrusted Opus files to prevent errors there or to detect errors. See also \fB-D\fR.
.TP
\fB-T\fR
Make sure that editing input ends with a line feed
.TP
\fB-D\fR
In output mode, do not output until all the tags in the Opus file have been read. Also implicitly specify \fB-V\fR. In writing mode, empty editing input is regarded as an error. Also implicitly specify \fB-T\fR
.TP
\fB-g \fIgain\fB\fR
Specify output gain in dB
.TP
\fB-s \fIscale\fB\fR
The output gain is specified by the magnification of the PCM sample. 1 at the same magnification. Half with 0.5 (converted to dB in command)
.TP
\fB-r\fR
Let the output gain specification be relative to the internal setting
.TP
\fB-1\fR
Set to Â± 1/256 dB when it becomes 0 when the output gain is set to internal format
.TP
\fB-Q\fR
Use Q7.8 format for output gain value
.TP
\fB-v\fR
Output value of output gain to standard error output
.TP
\fB-q\fR
It has no effect. It exists so as not to cause an error even if it is specified. (compatible with \fBvorbiscomment\fR(1))

.SH ENVIRONMENT VARIABLE
.TP
\fBLANG\fR
It is affected by the conversion between tag internal format UTF-8 and the locale character encoding scheme
.TP
\fBLC_NUMERIC\fR
Affected by the format of floating point numbers used for output gain editing
.TP
\fBLC_MESSAGES, NLSPATH\fR
It involves processing message catalogs

.SH EXIT STATUS
.PP
0 if the Opus file was successfully edited, 1 if there was an error in the option or editing tag input grammar, 2 if the Opus file format was wrong, 2 system incorrect errors such as file I / O If it does, it returns 3.

.SH EXAMPLE
.SS BASIC
.PP
\fBopuscomment\fR when specifying only one Opus file as an argument and activating it, it outputs the tag in that file to standard output.

.nf
opuscomment some.opus
.fi
.PP
If you want to edit the tag in the Opus file, you can edit \fBopuscomment\fR in write mode after editing its output with your favorite editor and pass it to standard input. This edit style follows \fBvorbiscomment\fR(1).

.nf
opuscomment some.opus >tags.txt
ed tags.txt
opuscomment -w some.opus <tags.txt
.fi
.PP
In Ogg Opus, there is a header item called output gain, and by changing it, the function that the volume can be freely changed even after encoding is attached as a codec standard. \fBopuscomment\fR corresponds to editing of its output gain.

.nf
# Reduce the sound level of -5.0 dB for Opus files with large volume
opuscomment -g -5.0 loud.opus
# You can check that the output gain has been changed with the item "Playback gain" of opusinfo(1)
opusinfo loud.opus
.fi

.SS OGG VORBIS TRANSITION
.PP
Ogg Vorbis and Ogg Opus have the same internal tag format and \fBopuscomment\fR implements an interface compatible with vorbiscomment, so you can easily port tags with the following command.

.nf
vorbiscomment -Re music-01.oga |opuscomment -wRe music-01.opus
.fi

.SS SIMULTANEOUS EDITING OF OPUS FILES
.PP
As a general theory of shell scripts, it is normal to redirect the result to another file and rename it once the file is connected to pipe and edited at the same time due to the timing of writing is there.

.nf
sed 's/dog/cat/g' <animal.txt >animal.txt.1
mv -f animal.txt.1 animal.txt
.fi
.PP
However, since \fBopuscomment\fR does not open Opus files for writing until tag reading is finished, even if the same file is opened before and after the filter, it will not be edited at the same time and the contents will not be lost.

.nf
# Even if you do not create a temporary file, editing that removes the DISCTOTAL and DISCNUMBER tags from some.opus is applied as intended.
opuscomment -e some.opus |grep -vE '^DISC(TOTAL|NUMBER)=' |opuscomment -we some.opus
.fi

.SH GRAMMAR
.PP
\fBopuscomment\fR for the tag input / output grammar handled in, the individual records are the same as the internal format of vorbis comment and are concatenated with the key name and the value =, like \fINAME=VALUE\fR, and the records are separated by a line feed There. For example
.PP

.nf
TITLE = Internet
ARTIST = Tomonori Arakawa
.fi
.PP
However, \fIVALUE\fR itself may contain line breaks, \fBopuscomment\fR escape line breaks in two ways.
.TP
\fB1. opuscomment how to define\fR
If a tab follows the newline, the line after the newline is handled as a continuation of the value of the previous line except for the first tab
.TP
\fB2. A method compatible with vorbiscomment when using -e\fR
Represent line breaks with escape sequence using backslash
.PP
\fBopuscomment\fR escape of one of these newlines is always applied, there is no missing line break if there is appropriate option specification and editing. Specifically, a record having the following contents:
.PP
.TP
\fBTitle\fR
COMMENT
.TP
\fBContent\fR
.nf
Tomonori Arakawa live
2017-08-12 recording
.fi
.PP
This is the first method of \fBopuscomment\fR
.PP

.nf
COMMENT=Tomonori Arakawa live<newline>
<tab>2017-08-12 recording
.fi
.PP
With the second vorbiscomment compatible format
.PP

.nf
COMMENT=Arakawa Tomonori live\\n2017-08-12 recording
.fi
.PP

.SH ATTENTION
.SS When editing with the escape of the OPUSCOMMENT method
.PP
Consider the situation where the same tag is copied to another Opus file for re-encoding. At this time, it is safe to exchange \fBopuscomment\fR directly with pipes to pass tags.
.PP

.nf
# Safe example
opuscomment old.opus |opuscomment -w re-encoded.opus
.fi
.PP
However, there is a possibility that it is not safe to put a filter to edit including row deletion. This is because if a record to be deleted is composed of a plurality of lines, if only the line including the item name is deleted, the remaining lines are regarded as the continuation of the previous record.
.PP

.nf
# Unsafe example
opuscomment old.opus |sed '/^COMMENT=/d' |opuscomment -w re-encoded.opus
.fi
.PP
In order to prevent this, it is necessary to design the filter in consideration of the fact that the record spans plural lines.
.PP

.nf
# Example of deletion considering multiple row records 1
opuscomment old.opus |sed '/^COMMENT=/{:loop; N; s/.*\\n<tab>//; t loop; D;}' |
  opuscomment -w re-encoded.opus
.fi
.PP
More simply, use the escape of the \fB-e\fR option.
.PP

.nf
# Example 2 of deletion considering multiple row records 2
opuscomment -e old.opus |sed '/^COMMENT=/d' |opuscomment -we re-encoded.opus
.fi

.SS Handling of NUL
.PP
If \fBopuscomment\fR is entered with the character "NUL", it is assumed to be an error at all. If the tag in Opus contained NUL, the character would be cut off in output mode. This is because vorbis comment stores UTF-8 text only, so it intentionally manifests the behavior that the text file will be broken when a binary file is entered. However, it can be avoided by specifying either \fB-R\fR or \fB-e\fR if necessary.

.SS Edit output gain and R128_TRACK_GAIN, R128_ALBUM_GAIN
.PP
According to \fIRFC 7845\fR specifying the Opus specification, it is MUST update or delete \fIR128_TRACK_GAIN\fR, \fIR128_ALBUM_GAIN\fR when editing the output gain. However, \fBopuscomment\fR does not implement processing based on this specification. Users of \fBopuscomment\fR need to incorporate gain adjustment editing into scripts with this specification in mind.
.SH SEE ALSO
\fBopusenc\fR(1), \fBopusinfo\fR(1), \fBopuschgain\fR(1), \fBvorbiscomment\fR(1), \fBmetaflac\fR(1), \fBop_set_gain_offset\fR(3)

.SH ENGLISH TRANSLATION
Google translator (https://translate.google.ru)

